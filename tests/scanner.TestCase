#!/usr/bin/env python3

import glob
import os

import testbase
import fdroidserver.metadata
import fdroidserver.scanner


class ScannerTest(testbase.TestBase):
    def test_scan_source_files(self):
        source_files = os.path.join(self.basedir, 'source-files')
        projects = {
            'Zillode': 1,
            'firebase-suspect': 1
        }
        for d in glob.glob(os.path.join(source_files, '*')):
            build = fdroidserver.metadata.Build()
            fatal_problems = fdroidserver.scanner.scan_source(d, build)
            self.assertEqual(projects.get(os.path.basename(d), 0),
                             fatal_problems)


if __name__ == "__main__":
    ScannerTest.main()
